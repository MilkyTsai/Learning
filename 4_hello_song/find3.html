<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>Hello Song å–®å­—è¿·å®®</title>
    <style>
        :root { --main-blue: #3498db; --success-green: #2ecc71; --error-red: #e74c3c; }
        body { font-family: 'Arial Rounded MT Bold', 'Microsoft JhengHei', sans-serif; background-color: #fcf8f3; text-align: center; margin: 0; padding: 20px; }
        .setup { margin-bottom: 20px; }
        #maze-container {
            display: grid;
            grid-template-columns: repeat(5, 120px);
            grid-gap: 10px;
            justify-content: center;
            margin: 20px auto;
            perspective: 1000px;
        }
        .cell {
            width: 120px; height: 100px; background: white; border: 3px solid #ddd;
            border-radius: 15px; display: flex; align-items: center; justify-content: center;
            font-size: 20px; cursor: pointer; transition: all 0.3s;
            box-shadow: 0 4px #ccc; position: relative;
        }
        .cell:active { transform: translateY(4px); box-shadow: none; }
        .cell.active { border-color: var(--main-blue); background: #ebf5fb; }
        .cell.correct { background: var(--success-green); color: white; border-color: #27ae60; box-shadow: 0 4px #27ae60; }
        .cell.wrong { background: var(--error-red); color: white; border-color: #c0392b; animation: shake 0.4s; }
        
        .start-tag { position: absolute; top: -25px; font-size: 14px; color: #e67e22; font-weight: bold; }
        .end-tag { position: absolute; bottom: -25px; font-size: 14px; color: #8e44ad; font-weight: bold; }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        #instruction { font-size: 24px; color: #2c3e50; margin-bottom: 10px; font-weight: bold; }
        .progress-bar { width: 640px; height: 10px; background: #ddd; margin: 20px auto; border-radius: 5px; overflow: hidden; }
        #progress-fill { width: 0%; height: 100%; background: var(--success-green); transition: width 0.5s; }
    </style>
</head>
<body>

    <h1>ğŸš€ Hello Song å–®å­—è¿·å®®æŒ‘æˆ°</h1>
    <div id="instruction">è«‹é»æ“Šç¬¬ä¸€å€‹å–®å­—ï¼šEvery day</div>
    
    <div class="progress-bar"><div id="progress-fill"></div></div>

    <div id="maze-container" id="maze">
        </div>

    <script>
        // æ­Œè©é †åºè·¯å¾‘
        const correctPath = ["Every day", "school", "friends", "Hello", "good", "great", "name", "meet", "play"];
        const zhMap = { "Every day": "æ¯ä¸€å¤©", "school": "å­¸æ ¡", "friends": "æœ‹å‹", "Hello": "å¦³å¥½", "good": "å¥½", "great": "å¾ˆæ£’", "name": "åå­—", "meet": "é‡è¦‹", "play": "ç©è€" };
        
        // æ··æ·†ç”¨çš„å–®å­—
        const fakes = ["Apple", "Book", "Cool", "Friday", "Go", "Night", "Sleep", "Toy", "ZOO", "Bye"];

        let currentStep = 0;
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        // èªéŸ³æ’­æ”¾ï¼šå¿µä¸‰æ¬¡ + ä¸­æ–‡
        function speakWordChain(en, zh) {
            window.speechSynthesis.cancel();
            for (let i = 0; i < 3; i++) {
                const msgEn = new SpeechSynthesisUtterance(en);
                msgEn.lang = 'en-US';
                msgEn.rate = 0.9;
                setTimeout(() => window.speechSynthesis.speak(msgEn), i * 1000);
            }
            const msgZh = new SpeechSynthesisUtterance(zh);
            msgZh.lang = 'zh-TW';
            setTimeout(() => window.speechSynthesis.speak(msgZh), 3 * 1000);
        }

        function playSound(isCorrect) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain); gain.connect(audioCtx.destination);
            if (isCorrect) {
                osc.frequency.setValueAtTime(880, audioCtx.currentTime);
                osc.start(); osc.stop(audioCtx.currentTime + 0.1);
            } else {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, audioCtx.currentTime);
                osc.start(); osc.stop(audioCtx.currentTime + 0.3);
            }
        }

        function initMaze() {
            const container = document.getElementById('maze-container');
            const totalCells = 20; // 4x5 è¿·å®®
            let cells = [];

            // 1. å…ˆæ”¾å…¥æ­£ç¢ºç­”æ¡ˆ
            correctPath.forEach(word => cells.push({ text: word, type: 'correct' }));
            // 2. æ”¾å…¥å¹²æ“¾é …
            while(cells.length < totalCells) {
                cells.push({ text: fakes[Math.floor(Math.random() * fakes.length)], type: 'fake' });
            }
            // 3. æ´—ç‰Œ
            cells.sort(() => Math.random() - 0.5);

            cells.forEach((data, index) => {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.textContent = data.text;
                
                if (data.text === correctPath[0]) {
                    cell.innerHTML += '<div class="start-tag">START ğŸš©</div>';
                }
                if (data.text === correctPath[correctPath.length-1]) {
                    cell.innerHTML += '<div class="end-tag">GOAL ğŸ</div>';
                }

                cell.onclick = () => {
                    if (audioCtx.state === 'suspended') audioCtx.resume();
                    
                    if (data.text === correctPath[currentStep]) {
                        // ç­”å°äº†
                        cell.classList.add('correct');
                        playSound(true);
                        speakWordChain(data.text, zhMap[data.text]);
                        currentStep++;
                        updateUI();
                    } else {
                        // ç­”éŒ¯äº†
                        cell.classList.add('wrong');
                        playSound(false);
                        setTimeout(() => cell.classList.remove('wrong'), 500);
                    }
                };
                container.appendChild(cell);
            });
        }

        function updateUI() {
            const progress = (currentStep / correctPath.length) * 100;
            document.getElementById('progress-fill').style.width = progress + '%';
            
            if (currentStep < correctPath.length) {
                document.getElementById('instruction').textContent = `ä¸‹ä¸€å¥æ˜¯ï¼š${correctPath[currentStep]}`;
            } else {
                document.getElementById('instruction').textContent = "ğŸ‰ å¤ªæ£’äº†ï¼ä½ å®Œæˆäº† Hello Song è¿·å®®ï¼";
                document.getElementById('instruction').style.color = "#2ecc71";
            }
        }

        initMaze();
    </script>
</body>
</html>